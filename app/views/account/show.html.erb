<div class="row">
  <div class="col-md-7">
    <table id="transactions-table" class="table table-condensed table-bordered table-striped table-hover">
      <thead>
        <tr>
          <td>Price</td>
          <td>Receiver</td>
          <td>Admin</td>
          <td>Comment</td>
          <td>Date</td>
        </tr>
      </thead>
      <tbody>
        <% @account.transactions.includes(:receiver).includes(:administrator).order(date: :desc).limit(50).each do |t| %>
          <tr>
            <td><%= t.price / 100.0 %></td>
            <td><%= t.receiver.try(:trigramme) %></td>
            <td><%= t.administrator.try(:trigramme) %></td>
            <td><%= t.comment %></td>
            <td><time <% if t.date.to_date == Date.today %>class="timeago"<% end %> datetime="<%= t.date %>"><%= t.date.strftime('%F %T') %></time></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="col-md-5">
    <div class="row">
      <div class="col-md-5">
        <h1 style="display: inline-block;"> <!-- inline-block because we want the icon on same line -->
          <strong><%= @account.trigramme %></strong>
          <% unless @account.x_platal? %>
            <br>
            <small><%= @account.readable_status %></small>
          <% end %>
        </h1>
        <a data-toggle="collapse" href="#trigrammeCollapse" aria-expanded="false" aria-controls="trigrammeCollapse"><%= fa_icon "pencil-square-o" %></a>
        <div class="collapse text-right" id="trigrammeCollapse">
          <%= bootstrap_form_tag(remote: true, html: { id: 'trigramme-form' }, url: "/account/#{@account.id}", method: :post) do |f| %>
            <%= f.text_field(:trigramme, hide_label: true, placeholder: 'Trigramme') %>
            <%= f.select(
              :status,
              Account.statuses.keys.map { |k| [k.tr('_', ' ').capitalize, k] },
              selected: @account.status, hide_label: true)
            %>
            <%= f.primary 'Save' %>
          <% end %>
        </div>
        <h2>
          <%= @account.first_name %> <%= @account.name %>
          <small><%= @account.promo %></small>
        </h2>
        <div>
          <a data-toggle="collapse" href="#nicknameCollapse" aria-expanded="false" aria-controls="nicknameCollapse"><%= fa_icon "pencil-square-o" %></a>
          <% if @account.nickname.nil? || @account.nickname.blank? %>
            <small><em>Nickname</em></small>
          <% else %>
            <%= @account.nickname %>
          <% end %>
        </div>
        <div class="collapse text-right" id="nicknameCollapse">
          <br>
          <%= bootstrap_form_tag(remote: true, html: { id: 'nickname-form' }, url: "/account/#{@account.id}", method: :post) do |f| %>
            <%= f.text_area(:nickname, rows: 3, hide_label: true, value: @account.nickname) %>
            <%= f.primary 'Save' %>
          <% end %>
          <br>
        </div>
      </div>
      <div class="col-md-7 text-right">
        <%= image_tag @account.local_picture, alt: @account.first_name, id: 'account-image' %>
      </div>
    </div>
    <h3>
      <%= if (@account.birthdate && Date.current.month == @account.birthdate.month && Date.current.day == @account.birthdate.day)
        fa_icon "birthday-cake 2x"
      end %>
      <% if @account.age %>
        <%= @account.age %> ans (<%= @account.birthdate %>)
      <% end %>
    </h3>
    <h1><strong><%= @account.balance / 100.0 %> €</strong></h1>
    <%= bootstrap_form_tag(remote: true, html: { id: 'log-form' }, url: "/account/log/#{@account.id}", method: :post, layout: :inline) do |f| %>
      <div class="row">
        <div class="col-md-6">
          <%= f.text_field(:amount, class: 'mousetrap', hide_label: true, placeholder: 'Paye, bâtard!', prepend: '€') %>
        </div>
        <div class="col-md-6">
          <%= f.text_field(:comment, class: 'mousetrap', hide_label: true, placeholder: 'Commentaire', append: f.primary('Log !')) %>
        </div>
      </div>
    <% end %>
    <br>
    <h3>Clopes</h3>
    <%= bootstrap_form_tag(remote: true, html: { id: 'clopes-form' }, url: "/account/clopes/#{@account.id}", method: :post, layout: :inline) do |f| %>
      <div class="row">
        <div class="col-md-6">
          <%= f.select(:clope_id, Clope.order(quantite: :desc).all.collect { |c| [c.marque, c.id] }, class: 'mousetrap', hide_label: true) %>
        </div>
        <div class="col-md-6">
          <%= f.number_field(:quantity, class: 'mousetrap', hide_label: true, value: 1, min: 1, append: f.primary('Log !')) %>
        </div>
      </div>
    <% end %>
    <h3>Créditer</h3>
    <%= bootstrap_form_tag(remote: true, html: { id: 'credit-form' }, url: "/account/credit/#{@account.id}", method: :post, layout: :inline) do |f| %>
      <div class="row">
        <div class="col-md-6">
          <%= f.text_field(:amount, class: 'mousetrap', hide_label: true, placeholder: 'Plus de thunes!', prepend: '€') %>
        </div>
        <div class="col-md-6">
          <%= f.text_field(:comment, class: 'mousetrap', hide_label: true, placeholder: 'Commentaire') %>
        </div>
      </div>
      <div class="form-group">
        <%= f.primary 'Chèque' %>
        <%= f.primary 'Liquide' %>
      </div>
    <% end %>
    <h3>Transfert</h3>
    <%= bootstrap_form_tag(remote: true, html: { id: 'transfer-form' }, url: "/account/transfer/#{@account.id}", method: :post, layout: :inline) do |f| %>
      <div class="row">
        <div class="col-md-6">
          <%= f.text_field(:amount, class: 'mousetrap', hide_label: true, placeholder: 'Paye, bâtard!', prepend: '€') %>
        </div>
        <div class="col-md-6">
          <%= f.text_field(:receiver, class: 'mousetrap', hide_label: true, placeholder: 'Trigramme') %>
        </div>
        <div class="col-md-6">
          <%= f.text_field(:comment, class: 'mousetrap', hide_label: true, placeholder: 'Commentaire') %>
        </div>
        <div class="col-md-6">
          <%= f.primary 'Transférer !' %>
        </div>
      </div>
    <% end %>
  </div>
</div>
